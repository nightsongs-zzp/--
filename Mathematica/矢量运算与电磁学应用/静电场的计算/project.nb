(* 静电场计算终极解决版（无符号嵌套+纯数值求解） *)
Clear["Global`*"];

(* ========== 1. 定义纯数值电势/电场函数 ========== *)
(* 总电势（纯数值计算） *)
PotentialNum[x_, y_, z_] := Module[{r1, r2, r3},
  r1 = Sqrt[(x - 1)^2 + y^2 + z^2];
  r2 = Sqrt[(x + 1)^2 + y^2 + z^2];
  r3 = Sqrt[x^2 + y^2 + (z - 1)^2];
  1/r1 + 1/r2 - 2/r3  (* q=1, k=1 *)
];

(* 电场（用数值梯度计算，避免符号嵌套） *)
EfieldNum[x_, y_, z_] := -N[Grad[PotentialNum[x, y, z], {x, y, z}]];


(* ========== 2. 绘制z=0平面图形（无符号冲突） ========== *)
Print["=== 任务1：z=0平面等势线+电场线 ==="];
pltContour = ContourPlot[
  PotentialNum[x, y, 0], {x, -3, 3}, {y, -3, 3},
  Contours -> 30, ContourStyle -> Hue[0.6],
  PlotLabel -> "z=0平面等势线", AxesLabel -> {"x", "y"}, PlotLegends -> Automatic
];

pltStream = StreamPlot[
  EfieldNum[x, y, 0][[1 ;; 2]], {x, -3, 3}, {y, -3, 3},
  StreamStyle -> Red, PlotLabel -> "z=0平面电场线", AxesLabel -> {"x", "y"}
];

Show[pltContour, pltStream, PlotLabel -> "等势线+电场线"];


(* ========== 3. 求解电场零点（纯数值迭代） ========== *)
Print["\n=== 任务2：电场零点求解 ==="];
(* 定义z轴上的电场z分量（纯数值函数） *)
EfieldZNum[z_] := EfieldNum[0, 0, z][[3]];

(* 用数值迭代求解（指定精度，避免发散） *)
zeroSolution = FindRoot[EfieldZNum[z] == 0, {z, 2}, WorkingPrecision -> 10];
zeroPoint = {0, 0, z} /. zeroSolution;
Print["电场零点坐标：", zeroPoint];


(* ========== 4. 标注零点的叠加图 ========== *)
Show[
  pltContour, pltStream,
  ListPlot[{{0, 0}}, PlotStyle -> {Black, PointSize[0.02]}],
  PlotLabel -> "等势线+电场线+电场零点"
];


(* ========== 5. 稳定性分析 ========== *)
Print["\n=== 任务2：稳定性分析 ==="];
Print["结论：该零点是不稳定平衡点。
物理意义：正电荷在零点附近受电场力会远离，微小扰动破坏平衡。"]