<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="description" content="å“ˆåŸºç±³ç‰ˆæœ¬çš„é€šè¿‡ç‚¹å‡»/è§¦æ‘¸æ’­æ”¾å£°éŸ³å¹¶å‡ºç°å˜åŒ–å›¾æ¡ˆçš„äº’åŠ¨å†…å®¹ã€‚">
  <title>Hakimitap</title>
  <style>
    /* åŸºç¡€æ ·å¼ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body, html {
      position: absolute;
      overflow: hidden;
      text-align: center;
      background: #ff9ec7; /* ç²‰è‰²èƒŒæ™¯ï¼Œç¬¦åˆå“ˆåŸºç±³çŒ«å’ªä¸»é¢˜ */
      color: #fff;
      font-family: Quicksand, "æ¸¸ã‚´ã‚·ãƒƒã‚¯", "Yu Gothic", "æ¸¸ã‚´ã‚·ãƒƒã‚¯ä½“", YuGothic, "Yu Gothic UI", "ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ Pro W3", "Hiragino Kaku Gothic Pro", "Meiryo UI", "ãƒ¡ã‚¤ãƒªã‚ª", Meiryo, sans-serif;
      width: 100%;
      height: 100%;
    }

    #view, #view canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    .scene {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 100;
      width: 90%;
      max-width: 640px;
    }

    /* é¡¶éƒ¨åœºæ™¯ */
    #scene_top {
      display: block;
    }

    #scene_top h1 {
      font-size: 1.5rem;
      margin-bottom: 25px;
      color: #fff;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    #scene_top h1:after {
      content: " ğŸ±";
      display: inline-block;
      animation: bounce 1s infinite alternate;
    }

    @keyframes bounce {
      0% { transform: translateY(0); }
      100% { transform: translateY(-5px); }
    }

    .ok {
      margin: 15px 0;
    }

    .attention {
      font-size: 0.9rem;
      margin-top: 25px;
    }

    .tit {
      margin-top: 20px;
      margin-bottom: 10px;
    }

    a {
      color: #fff;
      text-decoration: none;
      border-bottom: dashed 1px #fff;
    }

    button, .btn {
      background: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.9rem;
      padding: 8px 20px;
      transition: all 0.3s ease;
      display: inline-block;
    }

    button:hover, .btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    /* åŠ è½½åœºæ™¯ */
    #scene_loading {
      display: none;
    }

    #scene_loading hr {
      width: 0;
      height: 1px;
      background: #fff;
      border: none;
      transition: width 0.3s ease;
    }

    /* ä¸»åœºæ™¯ */
    #scene_main {
      display: none;
    }

    #scene_main .attention {
      pointer-events: none;
    }

    /* å…³äºåœºæ™¯ */
    #about_cover {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #fff;
      opacity: 0.5;
      z-index: 900;
      display: none;
    }

    #about {
      background: #ff9ec7;
      padding: 40px;
      border-radius: 10px;
      z-index: 1000;
      display: none;
    }

    #about .close {
      font-size: 2rem;
      cursor: pointer;
      margin-bottom: 20px;
    }

    #about .con {
      line-height: 1.7;
      margin-bottom: 20px;
    }

    #about .link {
      margin-top: 20px;
      line-height: 1.5;
    }

    /* æ§åˆ¶æŒ‰é’® */
    #bt_back, #bt_fs {
      position: absolute;
      z-index: 100;
      padding: 10px;
      font-size: 1rem;
      cursor: pointer;
      transition: 0.2s ease;
    }

    #bt_back {
      left: 0;
    }

    #bt_fs {
      right: 0;
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 640px) {
      #scene_top h1 {
        font-size: 1.2rem;
        margin-bottom: 18px;
      }

      .attention {
        font-size: 0.7rem;
      }

      .tit {
        font-size: 0.9rem;
      }

      #about {
        padding: 30px;
      }

      #about .close {
        font-size: 1.8rem;
      }
    }
  </style>
</head>

<body>
  <div id="view"></div>

  <!-- é¡¶éƒ¨åœºæ™¯ -->
  <div id="scene_top" class="scene">
    <h1>Hakimitap</h1>
    <div class="ok">
      <button id="bt_start">!å¼€å§‹!</button>
    </div>
    <p id="bt_about" class="btn">*å…³äº*</p>
    <div class="ok">
      <p class="attention">â€»è¯·æ‰“å¼€å£°éŸ³å¹¶äº«å—ã€‚</p>
    </div>
    <div class="ok">
      <p class="tit"><strong>æ³¨æ„ï¼æ”¹ç¼–å†…å®¹ï¼ŒåŸé¡¹ç›®: <a href="https://aidn.jp/mikutap">https://aidn.jp/mikutap</a></strong></p>
    </div>
  </div>

  <!-- åŠ è½½åœºæ™¯ -->
  <div id="scene_loading" class="scene">
    <hr size="1" color="#fff">
  </div>

  <!-- ä¸»åœºæ™¯ -->
  <div id="scene_main" class="scene">
    <div class="set">
      <p class="attention">ç‚¹å‡» &amp; æ‹–åŠ¨æˆ–è€…æŒ‰ä»»æ„é”®! è†å¬å“ˆåŸºç±³çš„å£°éŸ³~</p>
      <p id="bt_feedback" class="btn">åé¦ˆ: å¼€å¯</p>
      <p id="bt_backtrack" class="btn">èƒŒæ™¯éŸ³ä¹: å¼€å¯</p>
    </div>
  </div>

  <!-- å…³äºåœºæ™¯ -->
  <div id="about_cover"></div>
  <div id="about" class="scene">
    <p class="close" id="bt_close">Ã—</p>
    <p class="con">å£°éŸ³æ¥æº å“ˆåŸºç±³ï¼ˆçŒ«å«æ‹Ÿå£°è¯è¡ç”ŸéŸ³æºï¼‰</p>
    <p class="con">ä½œè€… <a href="https://aidn.jp" target="_blank">daniwell</a></p>
    <p class="link">çµæ„Ÿæ¥æº <a href="http://patatap.com/" target="_blank">Patatap</a><br>(ä»¤äººèµå¹çš„ç½‘é¡µ!)</p>
  </div>

  <!-- æ§åˆ¶æŒ‰é’® -->
  <div id="bt_back">ï¼œè¿”å›</div>
  <div id="bt_fs">â–¡å…¨å±æ˜¾ç¤º</div>

  <script>
    // Hakimitap - åŸºäºMikutapé£æ ¼çš„å“ˆåŸºç±³äº’åŠ¨éŸ³ä¹ç½‘ç«™
    document.addEventListener('DOMContentLoaded', function() {
        // ä¸»è¦DOMå…ƒç´ 
        const view = document.getElementById('view');
        const sceneTop = document.getElementById('scene_top');
        const sceneLoading = document.getElementById('scene_loading');
        const sceneMain = document.getElementById('scene_main');
        const about = document.getElementById('about');
        const aboutCover = document.getElementById('about_cover');
        const btStart = document.getElementById('bt_start');
        const btAbout = document.getElementById('bt_about');
        const btClose = document.getElementById('bt_close');
        const btBack = document.getElementById('bt_back');
        const btFs = document.getElementById('bt_fs');
        const btFeedback = document.getElementById('bt_feedback');

        // éŸ³é¢‘ç›¸å…³å˜é‡
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioContext = new AudioContext();
        let audioBuffers = {};
        let feedbackEnabled = true;

        // å“ˆåŸºç±³éŸ³æ•ˆæ–‡ä»¶è·¯å¾„
        const audioFiles = {
            ha: [
                'å½’æ¡£-2025-7-11--23-41/å“ˆ1.wav',
                'å½’æ¡£-2025-7-11--23-41/å“ˆ2.wav',
                'å½’æ¡£-2025-7-11--23-41/å“ˆ3.wav',
                'å½’æ¡£-2025-7-11--23-41/å“ˆ4.wav',
                'å½’æ¡£-2025-7-11--23-41/å“ˆ5.wav'
            ],
            ji: [
                'å½’æ¡£-2025-7-11--23-41/åŸº1.wav',
                'å½’æ¡£-2025-7-11--23-41/åŸº2.wav',
                'å½’æ¡£-2025-7-11--23-41/åŸº3.wav',
                'å½’æ¡£-2025-7-11--23-41/åŸº4.wav',
                'å½’æ¡£-2025-7-11--23-41/åŸº5.wav',
                'å½’æ¡£-2025-7-11--23-41/åŸº6.wav',
                'å½’æ¡£-2025-7-11--23-41/åŸº7.wav',
                'å½’æ¡£-2025-7-11--23-41/åŸº8.wav'
            ],
            mi: [
                'å½’æ¡£-2025-7-11--23-41/ç±³1.wav',
                'å½’æ¡£-2025-7-11--23-41/ç±³2.wav',
                'å½’æ¡£-2025-7-11--23-41/ç±³3.wav',
                'å½’æ¡£-2025-7-11--23-41/ç±³4.wav',
                'å½’æ¡£-2025-7-11--23-41/ç±³5.wav',
                'å½’æ¡£-2025-7-11--23-41/ç±³6.wav',
                'å½’æ¡£-2025-7-11--23-41/ç±³7.wav',
                'å½’æ¡£-2025-7-11--23-41/ç±³8.wav'
            ]
        };

        // åˆå§‹åŒ–éŸ³é¢‘
        async function initAudio() {
            for (const category in audioFiles) {
                audioBuffers[category] = [];
                for (const file of audioFiles[category]) {
                    try {
                        const response = await fetch(file);
                        const arrayBuffer = await response.arrayBuffer();
                        const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
                        audioBuffers[category].push(audioBuffer);
                    } catch (error) {
                        console.error(`Error loading audio file ${file}:`, error);
                    }
                }
            }
        }

        // æ’­æ”¾å“ˆåŸºç±³éŸ³æ•ˆ
        function playHakimiSound(category) {
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }

            if (!audioBuffers[category] || audioBuffers[category].length === 0) {
                console.error(`No audio buffers for category: ${category}`);
                return;
            }

            // éšæœºé€‰æ‹©ä¸€ä¸ªéŸ³æ•ˆ
            const randomIndex = Math.floor(Math.random() * audioBuffers[category].length);
            const audioBuffer = audioBuffers[category][randomIndex];

            // åˆ›å»ºéŸ³é¢‘æºå¹¶æ’­æ”¾
            const source = audioContext.createBufferSource();
            source.buffer = audioBuffer;
            source.connect(audioContext.destination);
            source.start();
        }

        // Canvasç›¸å…³å˜é‡
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];
        let shapes = [];
        let animationId = null;

        // åˆå§‹åŒ–Canvaså°ºå¯¸
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // ç²’å­ç±»
        class Particle {
            constructor(x, y, color, type) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.type = type;
                this.size = Math.random() * 15 + 5;
                this.speedX = (Math.random() - 0.5) * 10;
                this.speedY = (Math.random() - 0.5) * 10;
                this.life = 1;
                this.decay = Math.random() * 0.02 + 0.01;
                this.rotation = Math.random() * Math.PI * 2;
                this.rotationSpeed = (Math.random() - 0.5) * 0.2;
            }

            update() {
                this.x += this.speedX;
                this.y += this.speedY;
                this.speedY += 0.2; // é‡åŠ›
                this.life -= this.decay;
                this.size *= 0.98;
                this.rotation += this.rotationSpeed;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.life;
                ctx.fillStyle = this.color;
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);

                // æ ¹æ®ç±»å‹ç»˜åˆ¶ä¸åŒå½¢çŠ¶
                if (this.type === 0) { // åœ†å½¢
                    ctx.beginPath();
                    ctx.arc(0, 0, this.size, 0, Math.PI * 2);
                    ctx.fill();
                } else if (this.type === 1) { // æ–¹å½¢
                    ctx.fillRect(-this.size/2, -this.size/2, this.size, this.size);
                } else if (this.type === 2) { // ä¸‰è§’å½¢
                    ctx.beginPath();
                    ctx.moveTo(0, -this.size);
                    ctx.lineTo(-this.size, this.size);
                    ctx.lineTo(this.size, this.size);
                    ctx.closePath();
                    ctx.fill();
                }

                ctx.restore();
            }
        }

        // å½¢çŠ¶ç±»
        class Shape {
            constructor(x, y, color, type) {
                this.x = x;
                this.y = y;
                this.color = color;
                this.type = type;
                this.size = 0;
                this.maxSize = Math.random() * 100 + 50;
                this.growth = Math.random() * 5 + 2;
                this.life = 1;
                this.decay = 0.01;
                this.rotation = 0;
                this.rotationSpeed = (Math.random() - 0.5) * 0.1;
            }

            update() {
                if (this.size < this.maxSize) {
                    this.size += this.growth;
                } else {
                    this.life -= this.decay;
                }
                this.rotation += this.rotationSpeed;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.life;
                ctx.strokeStyle = this.color;
                ctx.lineWidth = 2;
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);

                // æ ¹æ®ç±»å‹ç»˜åˆ¶ä¸åŒå½¢çŠ¶
                if (this.type === 0) { // åœ†å½¢
                    ctx.beginPath();
                    ctx.arc(0, 0, this.size, 0, Math.PI * 2);
                    ctx.stroke();
                } else if (this.type === 1) { // æ–¹å½¢
                    ctx.strokeRect(-this.size/2, -this.size/2, this.size, this.size);
                } else if (this.type === 2) { // æ˜Ÿå½¢
                    const spikes = 5;
                    const outerRadius = this.size;
                    const innerRadius = this.size * 0.5;

                    ctx.beginPath();
                    for (let i = 0; i < spikes * 2; i++) {
                        const radius = i % 2 === 0 ? outerRadius : innerRadius;
                        const angle = (i * Math.PI) / spikes;
                        const x = Math.cos(angle) * radius;
                        const y = Math.sin(angle) * radius;

                        if (i === 0) {
                            ctx.moveTo(x, y);
                        } else {
                            ctx.lineTo(x, y);
                        }
                    }
                    ctx.closePath();
                    ctx.stroke();
                }

                ctx.restore();
            }
        }

        // åˆ›å»ºç²’å­çˆ†ç‚¸æ•ˆæœ
        function createParticles(x, y, color, count = 10) {
            for (let i = 0; i < count; i++) {
                const type = Math.floor(Math.random() * 3);
                particles.push(new Particle(x, y, color, type));
            }
        }

        // åˆ›å»ºå½¢çŠ¶
        function createShape(x, y, color) {
            const type = Math.floor(Math.random() * 3);
            shapes.push(new Shape(x, y, color, type));
        }

        // åŠ¨ç”»å¾ªç¯
        function animate() {
            // åŠé€æ˜è¦†ç›–ï¼Œåˆ›å»ºæ‹–å°¾æ•ˆæœ
            ctx.fillStyle = 'rgba(255, 158, 199, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // æ›´æ–°å’Œç»˜åˆ¶å½¢çŠ¶
            for (let i = shapes.length - 1; i >= 0; i--) {
                const shape = shapes[i];
                shape.update();
                shape.draw();

                if (shape.life <= 0) {
                    shapes.splice(i, 1);
                }
            }

            // æ›´æ–°å’Œç»˜åˆ¶ç²’å­
            for (let i = particles.length - 1; i >= 0; i--) {
                const particle = particles[i];
                particle.update();
                particle.draw();

                if (particle.life <= 0 || particle.y > canvas.height) {
                    particles.splice(i, 1);
                }
            }

            animationId = requestAnimationFrame(animate);
        }

        // åˆå§‹åŒ–éŸ³é¢‘åœ¨é¡µé¢åŠ è½½å®Œæˆåè°ƒç”¨
        initAudio();

        // å¤„ç†ç‚¹å‡»/è§¦æ‘¸äº‹ä»¶
        function handleInteraction(x, y) {
            // æ ¹æ®ä½ç½®å†³å®šé¢œè‰²å’ŒéŸ³æ•ˆç±»å‹
            let soundType, color;

            // å°†ç”»å¸ƒåˆ†ä¸ºä¸‰ä¸ªåŒºåŸŸï¼šä¸Šã€ä¸­ã€ä¸‹
            if (y < canvas.height / 3) {
                soundType = 'ha';
                color = '#FF6B9D'; // ç²‰è‰²
            } else if (y < (canvas.height * 2) / 3) {
                soundType = 'ji';
                color = '#C66FBC'; // ç´«è‰²
            } else {
                soundType = 'mi';
                color = '#7F7FD5'; // è“è‰²
            }

            // åˆ›å»ºå½¢çŠ¶å’Œç²’å­
            createShape(x, y, color);
            createParticles(x, y, color, 20);

            // æ’­æ”¾å“ˆåŸºç±³éŸ³æ•ˆ
            playHakimiSound(soundType);

            // å¦‚æœå¯ç”¨äº†åé¦ˆï¼Œæ·»åŠ æŒ¯åŠ¨
            if (feedbackEnabled && navigator.vibrate) {
                navigator.vibrate(50);
            }
        }

        // äº‹ä»¶ç›‘å¬å™¨
        canvas.addEventListener('mousedown', (e) => {
            handleInteraction(e.clientX, e.clientY);
        });

        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const touch = e.touches[0];
            handleInteraction(touch.clientX, touch.clientY);
        });

        // é”®ç›˜äº‹ä»¶
        document.addEventListener('keydown', (e) => {
            if (sceneMain.style.display === 'block') {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height;
                handleInteraction(x, y);
            }
        });

        // æŒ‰é’®äº‹ä»¶
        btStart.addEventListener('click', (e) => {
            e.preventDefault();
            sceneTop.style.display = 'none';
            sceneLoading.style.display = 'block';

            // æ¨¡æ‹ŸåŠ è½½è¿‡ç¨‹
            setTimeout(() => {
                sceneLoading.style.display = 'none';
                sceneMain.style.display = 'block';
                view.appendChild(canvas);
                animate();
            }, 1000);
        });

        btAbout.addEventListener('click', (e) => {
            e.preventDefault();
            about.style.display = 'block';
            aboutCover.style.display = 'block';
        });

        btClose.addEventListener('click', () => {
            about.style.display = 'none';
            aboutCover.style.display = 'none';
        });

        aboutCover.addEventListener('click', () => {
            about.style.display = 'none';
            aboutCover.style.display = 'none';
        });

        btBack.addEventListener('click', () => {
            sceneMain.style.display = 'none';
            sceneTop.style.display = 'block';
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            if (canvas.parentNode) {
                canvas.parentNode.removeChild(canvas);
            }
        });

        btFs.addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        });

        btFeedback.addEventListener('click', (e) => {
            e.preventDefault();
            feedbackEnabled = !feedbackEnabled;
            btFeedback.textContent = `åé¦ˆ: ${feedbackEnabled ? 'å¼€å¯' : 'å…³é—­'}`;
        });



        // åˆå§‹æ˜¾ç¤º
        sceneTop.style.display = 'block';
    });
  </script>
</body>

</html>